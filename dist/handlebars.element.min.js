// handlebars.element
// ------------------
// v0.1.0
//
// Copyright (c) 2013-2014 Mateus Maso
// Distributed under MIT license
//
// http://github.com/mateusmaso/handlebars.element

!function(a,b){"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=b(global.Handlebars)),exports=b(global.Handlebars)):b(a.Handlebars)}(this,function(a){var b=a.Utils,c=a.Utils.extend,d=a.Utils.escapeExpression;a.store={},a.elements={},a.attributes={},a.store.hold=function(b,c){return a.store[b]=c},a.store.release=function(b){var c=a.store[b];return delete a.store[b],c},a.Utils.extend=function(a,b){return c.apply(this,[a,b]),a},a.Utils.isObject=function(a){return a===Object(a)},a.Utils.isString=function(a){return"[object String]"==toString.call(a)},a.Utils.uniqueId=function(){var a=function(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b};return a()+a(!0)+a(!0)+a()},a.Utils.flatten=function(a,c){c=c||[];for(var d=0;d<a.length;d++)b.isArray(a[d])?b.flatten(a[d],c):c.push(a[d]);return c},a.Utils.camelize=function(a){return a.trim().replace(/[-_\s]+(.)?/g,function(a,b){return b?b.toUpperCase():""})},a.Utils.replaceWith=function(a,c){c=b.isArray(c)?c:[c];for(var d=0;d<c.length;d++)0==d?a.parentNode.replaceChild(c[d],a):b.insertAfter(c[d-1],c[d])},a.Utils.insertAfter=function(a,c){c=b.isArray(c)?c.slice():[c],c.unshift(a);for(var d=1;d<c.length;d++)c[d-1].nextSibling?c[d-1].parentNode.insertBefore(c[d],c[d-1].nextSibling):c[d-1].parentNode.appendChild(c[d])},a.Utils.escapeExpression=function(c){if(!b.isObject(c)||c instanceof a.SafeString)c===!1&&(c=c.toString());else{var e=b.uniqueId();a.store.hold(e,c),c=e}return d.apply(this,[c])},a.registerElement=function(a,b,c){b.options=c||{},this.elements[a]=b},a.registerAttribute=function(a,b,c){b.options=c||{},this.attributes[a]=b},a.parseValue=function(b,c){var d=a.store.release(b);return d?b=d:"true"==b?b=!0:"false"==b?b=!1:"null"==b?b=void 0:"undefined"==b?b=void 0:isNaN(b)||""==b||(b=parseFloat(b)),c?b||""===b?!0:!1:""===b?void 0:b},a.parseHTML=function(c){var d=[];if(b.isString(c)){var e=document.createElement("div");e.innerHTML=c.trim();var f=e.childNodes}else var f=c;for(var g=b.flatten(f);0!=g.length;){for(var h=[],i=0;i<g.length;i++){for(var j={owner:g[i],element:void 0,attributes:[]},k=b.flatten(g[i].childNodes),l=0;l<k.length;l++)h.push(k[l]);if(g[i].attributes)for(var l=0;l<g[i].attributes.length;l++)/hb-/i.test(g[i].attributes[l].name)&&j.attributes.push(g[i].attributes[l]);/^hb-/i.test(g[i].nodeName)&&(j.element=g[i]),(j.element||j.attributes.length>0)&&d.unshift(j)}g=h}for(var i=0;i<d.length;i++){var m=d[i].owner,n=d[i].element,o=d[i].attributes;if(o.length>0)for(var l=0;l<o.length;l++){var p=o[l],q=p.name.replace("hb-",""),r=a.attributes[q],s=r.apply(p,[m]);s&&m.setAttributeNode(s),m.removeAttributeNode(p),r.options.ready&&!/hb-/i.test(m.tagName.toLowerCase())&&r.options.ready.apply(p,[m])}if(n){for(var t={},u=n.tagName.toLowerCase().replace("hb-",""),v=a.elements[u],l=0;l<n.attributes.length;l++){var p=n.attributes.item(l),q=b.camelize(p.nodeName),w=v.options.booleans&&v.options.booleans.indexOf(q)>=0;t[q]=a.parseValue(p.nodeValue,w)}var x=v.apply(n,[t]);b.replaceWith(n,x);for(var l=0;l<o.length;l++){var p=o[l],q=p.name.replace("hb-",""),r=a.attributes[q];r.options.ready&&r.options.ready.apply(p,[x])}}}return b.flatten(f)}});